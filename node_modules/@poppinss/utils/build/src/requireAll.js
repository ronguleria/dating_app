"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = require("path");
const require_all_1 = __importDefault(require("require-all"));
const esmResolver_1 = require("./esmResolver");
function fileFilter(file) {
    const ext = path_1.extname(file);
    if (ext === '.ts' && !file.endsWith('.d.ts')) {
        return file.replace(new RegExp(`${ext}$`), '');
    }
    if (['.js', '.json'].includes(ext)) {
        return file.replace(new RegExp(`${ext}$`), '');
    }
    return false;
}
function requireAll(location, recursive = true, optional = false) {
    try {
        return require_all_1.default({
            dirname: location,
            recursive,
            filter: fileFilter,
            resolve: esmResolver_1.esmResolver,
        });
    }
    catch (error) {
        if (error.code === 'ENOENT' && optional) {
            return;
        }
        else {
            throw error;
        }
    }
}
exports.requireAll = requireAll;
